{
    
    style: NATS_style.json,
    styleoverride: {
        laneWidthRel: [ 1.0, 1.0, 1.0, 1.0 ],
        lanes: 4,
        borderbottom: 45,
        titleFontSize: 11,
        bullets: false,
        bodyLineSpacingRel: 0.15,
        
       
        
    },

    "pageHeader": "CLI Extended",
    "pageFooter": "**Created by Synadia, the team behind NATS - www.synadia.com**   https://github.com/roeschter/cheat-sheet-nats-synadia",


    "blocks": [
        { 
            "title": "**General**",
            "items": [
              
               
                
             
       
                "Authenticating with nats cli password, nkey, creds",
                "Explain nats server report in more detail, including new watch option",
                "Explain nats server request in more detail",
                { 
                    "items": [
                        "- Subscriptions",
                        "- kick",
                        "- ... ", 
                        
                    ]    
                },
                "nats auth",

                "Leaderhsip change",
                "Removing a node from a cluster - find meta group members?",
                "Scaling a stream down and up",
                "Catching a stream create with --trace and creating a stream with --config",
                "TLS testing",
            ]    
        },
        { 
            "title": "**Server Configuration**",
            "items": [
                "Obtain current server configuration and statistics (SYS)",
                "``**nats server request variables**``",
                "Reload server config file (SYS) - server id can be obtained from above",
                "``**nats server config reload <server id>**``",
            ]    
        },
        { 
            "title": "**Graphs - ASCII Dashboard**",
            "items": [
                "A number of commands have a ``**graph**`` subcommand or ``**--graph**`` option.",
                "``**nats server graph**``",
                "``**nats stream graph <stream>**``",
                "``**nats consumer graph <stream> <consumer>**``",
                "Graph subject traffic. E.g. Jetstream consumer management.",
                "``**nats sub '$JS.API.CONSUMER.CREATE.>' '$JS.API.CONSUMER.INFO.>'  '$JS.API.CONSUMER.DELETE.>' --graph**``",
            ]    
        },
        { 
            "title": "**Extended Health Check**",
            "items": [
                "**Health probe (SYS) - used by Kubernetes et. al.**",
                "``**nats server report health**``",
                { 
                    bullets: true,
                    "items": [
                        "Ensure you see all servers and all report 200",
                        "Repeat multiple times if needed",                        
                    ]    
                },
            ]    
        },
        { 
            "items": [
                "**Check clusters and routes (SYS)**",
                "``**nats server ls <server count>**``",
                { 
                    bullets: true,
                    "items": [
                        "Ensure all servers respond quickly. This means all expected servers replied.",
                        "Ensure there are 0 slow consumers",
                        "Ensure routes/GW are consistent",
                        "Look for consistent versions",
                        "Look for consistent CPU usage",    
                        "Look for consistent uptime",
                        "Look for consistent memory usage. Is one server using RAM excessivly?",
                        "Check the number of connections.",
                   
                    ]    
                },
            ]    
        },
        { 
            "items": [
                "**Message traffic (SYS) - Run as system user for extended info**",
                "``**nats traffic**``",
                { 
                    bullets: true,
                    "items": [
                        "**Raft:** Ensure votes are all to 0 (non zero may indicate instability)",
                        "**Raft:** Ensure append is half of reply", 
                        "**General:** Ensure there are less than 1000 JS API Requests per second",                        
                    ]    
                },
            ]    
        },
        { 
            "items": [
                "**Jetstream health - Note that not all servers may have Jetstream enabled (SYS)**",
                "``**nats server report jetstream <JS server count>**``",
                { 
                    bullets: true,
                    "items": [
                        "Ensure all servers respond quickly. This means all expected servers replied.",
                        "Ensure lag is 0", 
                        "Ensure the number of consumers is as expected",  
                        "Make sure there is a stable meta leader",                            
                    ]    
                },
            ]    
        },
        {
            "items": [
                "**Exhaustive Stream and consumer status (SYS) WARNING - These reports can be large and impact server performance** ",
                "``**nats server stream-check**``",
                "``**nats server consumer-check**``",
                { 
                    bullets: true,
                    "items": [
                        "Check for out of sync streams and consumers. Use ``**--unsynced**`` to filter.",
                        "Check for expected replicas count, stream size, message count", 
                        "Check for offline peers",
                    ]    
                },
            ]    
        },
        
        { 
            "items": [
                "**Gather and analyze information for auditing**",
                "``**nats audit gather**``",
                { 
                    bullets: true,
                    "items": [
                        "Keep audit data for post mortem.",                
                    ]    
                },
             
                "**And do a quick analysis**",
                "``**nats audit analyze**``",
                { 
                    bullets: true,
                    "items": [
                        "This is not an exhaustive report. Details may change over time.",
                        "See ``**nats audit checks**`` for a list of checks.",
                                        
                    ]    
                },
                 
            ]    
        },
    ]
}


